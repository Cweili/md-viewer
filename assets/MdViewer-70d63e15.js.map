{"version":3,"file":"MdViewer-70d63e15.js","sources":["../../../node_modules/clipboard-copy/index.js","../../../node_modules/async-throttle-cache/dist/async-throttle-cache.esm.js","../../../src/libs/utils.ts","../../../src/libs/mermaid/index.ts","../../../src/libs/index.ts","../../../src/components/MdViewer/MdViewer.tsx"],"sourcesContent":["/*! clipboard-copy. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */\n/* global DOMException */\n\nmodule.exports = clipboardCopy\n\nfunction makeError () {\n  return new DOMException('The request is not allowed', 'NotAllowedError')\n}\n\nasync function copyClipboardApi (text) {\n  // Use the Async Clipboard API when available. Requires a secure browsing\n  // context (i.e. HTTPS)\n  if (!navigator.clipboard) {\n    throw makeError()\n  }\n  return navigator.clipboard.writeText(text)\n}\n\nasync function copyExecCommand (text) {\n  // Put the text to copy into a <span>\n  const span = document.createElement('span')\n  span.textContent = text\n\n  // Preserve consecutive spaces and newlines\n  span.style.whiteSpace = 'pre'\n  span.style.webkitUserSelect = 'auto'\n  span.style.userSelect = 'all'\n\n  // Add the <span> to the page\n  document.body.appendChild(span)\n\n  // Make a selection object representing the range of text selected by the user\n  const selection = window.getSelection()\n  const range = window.document.createRange()\n  selection.removeAllRanges()\n  range.selectNode(span)\n  selection.addRange(range)\n\n  // Copy text to the clipboard\n  let success = false\n  try {\n    success = window.document.execCommand('copy')\n  } finally {\n    // Cleanup\n    selection.removeAllRanges()\n    window.document.body.removeChild(span)\n  }\n\n  if (!success) throw makeError()\n}\n\nasync function clipboardCopy (text) {\n  try {\n    await copyClipboardApi(text)\n  } catch (err) {\n    // ...Otherwise, use document.execCommand() fallback\n    try {\n      await copyExecCommand(text)\n    } catch (err2) {\n      throw (err2 || err || makeError())\n    }\n  }\n}\n","var returnSelf = function returnSelf(result) {\n  return Promise.resolve(result);\n};\n\nfunction asyncThrottleCache(fn, wait, _temp) {\n  if (wait === void 0) {\n    wait = 0;\n  }\n\n  var _ref = _temp === void 0 ? {} : _temp,\n      _ref$key = _ref.key,\n      key = _ref$key === void 0 ? function () {\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return JSON.stringify(args);\n  } : _ref$key,\n      _ref$serialize = _ref.serialize,\n      serialize = _ref$serialize === void 0 ? returnSelf : _ref$serialize,\n      _ref$deserialize = _ref.deserialize,\n      deserialize = _ref$deserialize === void 0 ? returnSelf : _ref$deserialize;\n\n  var cache = {};\n  return function () {\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n\n    // eslint-disable-line func-names\n    var cacheKey = key.apply(void 0, args);\n\n    if (cache[cacheKey]) {\n      var cached = cache[cacheKey];\n      var e = cached.e,\n          r = cached.r,\n          f = cached.f;\n\n      if (e !== undefined) {\n        return Promise.reject(e);\n      }\n\n      if (f) {\n        return deserialize(r);\n      }\n\n      return new Promise(function (resolve, reject) {\n        cached.s.push(resolve);\n        cached.j.push(reject);\n      });\n    }\n\n    cache[cacheKey] = {\n      s: [],\n      j: [],\n      t: setTimeout(function () {\n        var cached = cache[cacheKey];\n\n        if (cached) {\n          if (cached.f) {\n            delete cache[cacheKey];\n          } else {\n            cached.t = 0;\n          }\n        }\n      }, wait)\n    };\n\n    var onFinish = function onFinish(err, result) {\n      var cached = cache[cacheKey];\n\n      if (cached) {\n        var j = cached.j,\n            s = cached.s;\n        cached.f = true;\n\n        if (err) {\n          cached.e = err;\n          j.map(function (f) {\n            return f(err);\n          });\n        } else {\n          serialize(result).then(function (r) {\n            cached.r = r;\n            s.map(function (f, i) {\n              return deserialize(r).then(f, j[i]);\n            });\n          }, onFinish);\n        }\n\n        if (!cached.t) {\n          delete cache[cacheKey];\n        }\n      }\n\n      return result;\n    };\n\n    return fn.apply(this, args).then(function (result) {\n      return onFinish(undefined, result);\n    }, function (err) {\n      onFinish(err);\n      return Promise.reject(err);\n    });\n  };\n}\n\nexport default asyncThrottleCache;\n","import cache from 'async-throttle-cache'\n\n// eslint-disable-next-line import/prefer-default-export, no-restricted-globals\nexport const loadScript = cache(async (url: string, prefix: string, context = self) => {\n  const resp = await fetch(`${prefix}${url}`, {\n    cache: 'force-cache',\n  })\n  const text = await resp.text()\n  // eslint-disable-next-line no-new-func\n  return (new Function('globalThis', 'self', text))(context, context)\n}, 60000)\n","import type { Mermaid } from 'mermaid'\n\nimport type {\n  MarkdownOptions,\n} from '../types'\n\nimport {\n  loadScript,\n} from '../utils'\n\nconst regex = /```mermaid([\\S\\s]+?)```/g\nconst context: {\n  mermaid?: Mermaid\n} = {}\nasync function getMermaid(options: MarkdownOptions) {\n  let { mermaid } = context\n  if (!mermaid) {\n    await loadScript(options.cdn!.libs!.mermaid, options.cdn!.prefix, context)\n    mermaid = context.mermaid\n  }\n  return mermaid!\n}\n\nexport default function configMermaid(options: MarkdownOptions) {\n  return async function renderMermaid(text: string, html: string) {\n    const mermaids = text.match(regex)\n    let result = html\n    if (mermaids) {\n      const mermaid = await getMermaid(options)\n      const mermaidGraphs = await Promise.all(\n        mermaids.map(\n          (src) => mermaid.render(`mermaid${`${Math.random()}`.substr(2)}`, src.replace(regex, '$1'))\n            .then((renderResult) => renderResult.svg)\n            .catch((err) => console.error(err)),\n        ),\n      )\n      result = result.replace(\n        /(<pre><code class=\"language-mermaid\">[\\S\\s]+?<\\/code><\\/pre>)/g,\n        ($0, $1) => `${$1}<p>${mermaidGraphs.shift() || ''}</p>`,\n      )\n    }\n    return result\n  }\n}\n","// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-ignore\nimport MdWorker from './worker?worker&inline'\nimport mermaid from './mermaid'\nimport type { MarkdownOptions } from './types'\n\nconst libsMinVersion = process.env.NODE_ENV === 'development' ? '' : '.min'\nconst defaultOptions = {\n  katex: {},\n  marked: {},\n  cdn: {\n    prefix: 'https://cdn.jsdelivr.net/npm/',\n    libs: {\n      marked: `marked@9.1.2/lib/marked.umd${libsMinVersion}.js`,\n      prismjs: `prismjs@1.29.0/components/prism-core${libsMinVersion}.js`,\n      katex: `katex@0.16.9/dist/katex${libsMinVersion}.js`,\n      mermaid: `mermaid@10.5.1/dist/mermaid${libsMinVersion}.js`,\n    },\n  },\n}\n\nexport function markdown(options: MarkdownOptions = defaultOptions) {\n  const opts = {\n    ...defaultOptions,\n    ...options,\n    ...(options.cdn && {\n      cdn: {\n        ...defaultOptions.cdn,\n        ...options.cdn,\n        libs: {\n          ...defaultOptions.cdn.libs,\n          ...options.cdn.libs,\n        },\n      },\n    }),\n  }\n  const mdWorker = new MdWorker()\n  const resolves: ((html: string) => void)[] = []\n  const onResolve = (event: MessageEvent) => {\n    resolves.shift()?.(event.data)\n  }\n  mdWorker.postMessage(opts)\n  mdWorker.addEventListener('message', onResolve)\n  const renderMarkdown = (text: string) => new Promise<string>((res) => {\n    if (text) {\n      resolves.push(res)\n      mdWorker.postMessage(text)\n    } else {\n      res(text)\n    }\n  })\n  renderMarkdown.mermaid = mermaid(options)\n  return renderMarkdown\n}\n\nexport type {\n  MarkdownOptions,\n}\n","import React, {\n  useState,\n  useMemo,\n  useEffect,\n} from 'react'\nimport clipboardCopy from 'clipboard-copy'\n\nimport style from './MdViewer.module.scss'\n\nimport {\n  markdown,\n  MarkdownOptions,\n} from '../../libs'\n\nexport interface MdViewerProps {\n  /** Markdown */\n  children?: string\n  /** MarkdownOptions */\n  options?: MarkdownOptions\n}\n\nexport function MdViewer({\n  children,\n  options,\n}: MdViewerProps) {\n  const [html, setHtml] = useState<string>()\n  const render = useMemo(() => markdown(options), [options])\n\n  const onCopy = (e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    const target = e.target as HTMLElement\n    const targetIsCode = target.tagName === 'PRE'\n    const targetIsDoc = target.className === style.copy\n    if (targetIsCode || targetIsDoc) {\n      clipboardCopy(targetIsDoc ? children as string : target.innerText)\n      const { classList } = targetIsDoc ? target.parentElement! : target\n      classList.add(style.copied)\n      setTimeout(() => {\n        classList.remove(style.copied)\n      }, 200)\n    }\n  }\n\n  useEffect(() => {\n    if (children) {\n      render(children)\n        .then((newHtml) => render.mermaid(children, newHtml))\n        .then(setHtml)\n    }\n  }, [children])\n\n  return html ? (\n    <div\n      className={style.md}\n    >\n      <div\n        aria-hidden=\"true\"\n        role=\"button\"\n        className={style.copy}\n        onClick={onCopy}\n      />\n      <div\n        dangerouslySetInnerHTML={{ __html: html }}\n        onClick={onCopy}\n      />\n    </div>\n  ) : null\n}\n"],"names":["clipboardCopy_1","clipboardCopy","makeError","copyClipboardApi","text","copyExecCommand","span","selection","range","success","err","err2","returnSelf","result","asyncThrottleCache","fn","wait","_temp","_ref","_ref$key","key","_len","args","_key","_ref$serialize","serialize","_ref$deserialize","deserialize","cache","_len2","_key2","cacheKey","cached","e","r","f","resolve","reject","onFinish","j","s","i","loadScript","url","prefix","context","regex","getMermaid","options","mermaid","configMermaid","html","mermaids","mermaidGraphs","src","renderResult","$0","$1","libsMinVersion","defaultOptions","markdown","opts","mdWorker","MdWorker","resolves","onResolve","event","_a","renderMarkdown","res","MdViewer","children","setHtml","useState","render","useMemo","onCopy","target","targetIsCode","targetIsDoc","style","classList","setTimeout","useEffect","React","_jsxFileName"],"mappings":"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","x_google_ignoreList":[0,1]}